<?xml version="1.0"?>
<clickhouse>
    <profiles>
        <!-- Default profile for development -->
        <default>
            <!-- Memory limits -->
            <max_memory_usage>1000000000</max_memory_usage> <!-- 1GB -->
            <use_uncompressed_cache>0</use_uncompressed_cache>
            
            <!-- Performance settings -->
            <load_balancing>random</load_balancing>
            <max_query_size>268435456</max_query_size> <!-- 256MB -->
            <max_ast_depth>1000</max_ast_depth>
            <max_ast_elements>50000</max_ast_elements>
            <max_expanded_ast_elements>500000</max_expanded_ast_elements>
            
            <!-- Timeouts -->
            <connect_timeout>10</connect_timeout>
            <receive_timeout>300</receive_timeout>
            <send_timeout>300</send_timeout>
            <tcp_keep_alive_timeout>10</tcp_keep_alive_timeout>
            <http_connection_timeout>2</http_connection_timeout>
            <http_send_timeout>30</http_send_timeout>
            <http_receive_timeout>30</http_receive_timeout>
            
            <!-- Query execution -->
            <max_threads>4</max_threads>
            <max_concurrent_queries_for_user>10</max_concurrent_queries_for_user>
            <max_execution_time>300</max_execution_time>
            <max_rows_to_read>100000000</max_rows_to_read>
            <max_bytes_to_read>1000000000</max_bytes_to_read>
            
            <!-- Results -->
            <max_result_rows>100000</max_result_rows>
            <max_result_bytes>100000000</max_result_bytes>
            <result_overflow_mode>break</result_overflow_mode>
            
            <!-- INSERT settings -->
            <max_insert_block_size>1048576</max_insert_block_size>
            <min_insert_block_size_rows>1048576</min_insert_block_size_rows>
            <min_insert_block_size_bytes>268435456</min_insert_block_size_bytes>
            
            <!-- Optimization -->
            <optimize_throw_if_noop>1</optimize_throw_if_noop>
            <enable_optimize_predicate_expression>1</enable_optimize_predicate_expression>
            
            <!-- Development-friendly settings -->
            <log_queries>1</log_queries>
            <log_query_threads>1</log_query_threads>
            <log_profile_events>1</log_profile_events>
            <log_query_settings>1</log_query_settings>
            
            <!-- Allow experimental features -->
            <allow_experimental_window_functions>1</allow_experimental_window_functions>
            <allow_experimental_geo_types>1</allow_experimental_geo_types>
            <allow_experimental_bigint_types>1</allow_experimental_bigint_types>
            
            <!-- Development safety -->
            <cancel_http_readonly_queries_on_client_close>1</cancel_http_readonly_queries_on_client_close>
            <readonly>0</readonly>
        </default>
        
        <!-- Read-only profile for analytics -->
        <readonly>
            <readonly>1</readonly>
            <max_memory_usage>500000000</max_memory_usage> <!-- 500MB -->
            <max_execution_time>60</max_execution_time>
            <max_rows_to_read>10000000</max_rows_to_read>
            <max_result_rows>10000</max_result_rows>
            <max_concurrent_queries_for_user>5</max_concurrent_queries_for_user>
        </readonly>
    </profiles>

    <users>
        <!-- Default admin user for development -->
        <default>
            <password_sha256_hex></password_sha256_hex> <!-- Empty password for development -->
            <networks incl="networks_config" />
            <profile>default</profile>
            <quota>default</quota>
            <databases>
                <database>evalforge</database>
                <database>system</database>
            </databases>
            <access_management>1</access_management>
        </default>
        
        <!-- EvalForge application user -->
        <evalforge>
            <password>evalforge_dev</password>
            <networks>
                <ip>::/0</ip>
            </networks>
            <profile>default</profile>
            <quota>default</quota>
            <databases>
                <database>evalforge</database>
            </databases>
            <access_management>0</access_management>
        </evalforge>
        
        <!-- Read-only user for analytics/dashboards -->
        <analytics>
            <password>analytics_dev</password>
            <networks>
                <ip>::/0</ip>
            </networks>
            <profile>readonly</profile>
            <quota>default</quota>
            <databases>
                <database>evalforge</database>
            </databases>
            <access_management>0</access_management>
        </analytics>
    </users>

    <quotas>
        <!-- Default quota -->
        <default>
            <interval>
                <duration>3600</duration> <!-- 1 hour -->
                <queries>1000</queries>
                <errors>100</errors>
                <result_rows>1000000000</result_rows>
                <read_rows>1000000000</read_rows>
                <execution_time>3600</execution_time>
            </interval>
        </default>
        
        <!-- Analytics quota (more restrictive) -->
        <analytics_quota>
            <interval>
                <duration>3600</duration>
                <queries>500</queries>
                <errors>50</errors>
                <result_rows>10000000</result_rows>
                <read_rows>100000000</read_rows>
                <execution_time>1800</execution_time>
            </interval>
        </analytics_quota>
    </quotas>

    <networks_config>
        <networks>
            <!-- Allow connections from anywhere for development -->
            <ip>::/0</ip>
        </networks>
    </networks_config>
</clickhouse>